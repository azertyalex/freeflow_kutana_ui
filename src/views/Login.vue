<template>
  <v-row align="center" justify="center">
      <v-card :loading="$route.query.callback" width="500">
        <v-card-title>
          Freeflow Connect
        </v-card-title>
        <v-card-text v-if="$route.query.callback">
          Validating auth...
        </v-card-text>
        <v-container  v-else>
          <v-card-text>
            Please login using 3Bot Connect or continue as guest.
          </v-card-text>
          <v-card-actions>
            <v-btn v-on:click="threebotConnectLogin" text>Use 3Bot Connect</v-btn>
            <v-spacer></v-spacer>
            <v-btn v-on:click="guestLogin" text>Continue as Guest</v-btn>
          </v-card-actions>
        </v-container>
      </v-card>
  </v-row>
</template>
<script>
import { mapActions, mapGetters } from 'vuex'
export default {
  mounted () {
    if(this.$route.query.callback) {
      this.checkResponse(window.location.href)
    } 
  },
  methods: {
    ...mapActions([
      'generateLoginUrl',
      'checkResponse'
    ]),
    threebotConnectLogin: function() {
      this.generateLoginUrl(this.$route.query)
    },
    guestLogin: function() {
      this.$router.push( { path: "guestlogin", query: { 'redirect' : this.$route.query.redirect}});
    }
  },
  computed: {
    ...mapGetters([
      'loginUrl',
      'account'
    ])
  },
  watch: {
    loginUrl(val) {
      if(val){
        window.location.replace(val)
      }
    },
    account(val) {
      if(val) {
        if(this.$route.query.redirect) {
          this.$router.push(this.$route.query.redirect)
        } else {
          this.$router.push({name: 'room'})
        }
      }
    }
  }
}
</script>